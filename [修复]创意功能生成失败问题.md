# åˆ›æ„åŠŸèƒ½ç”Ÿæˆå¤±è´¥é—®é¢˜ä¿®å¤

## ğŸ› é—®é¢˜æè¿°

ä»¥ä¸‹ä¸‰ä¸ªåˆ›æ„åŠŸèƒ½ä¸€ç›´æ˜¾ç¤º"ç”Ÿæˆå¤±è´¥"é”™è¯¯ï¼š
- åå·®èŒæŒ‘æˆ˜ (Contrast Challenge)
- ç©¿è¶Šç›¸å†Œ (Time Travel Album)
- å¦‚æœæˆ‘æ˜¯ (What If I Am)

## ğŸ” é—®é¢˜æ ¹æº

### å‘ç°çš„å…³é”®é—®é¢˜

**APIå“åº”è§£ææ–¹å¼ä¸ä¸€è‡´ï¼**

#### âŒ é”™è¯¯çš„è§£ææ–¹å¼ï¼ˆæ–°åŠŸèƒ½ï¼‰
```typescript
const data = await response.json();
return data.images?.[0]?.url || data.output?.[0]?.url || data.image;
```

#### âœ… æ­£ç¡®çš„è§£ææ–¹å¼ï¼ˆoutfit-change.tsxï¼‰
```typescript
const data = await response.json();

if (!data.image || !data.image.base64Data) {
  throw new Error('ç”Ÿæˆå¤±è´¥: æœåŠ¡å™¨è¿”å›æ•°æ®æ ¼å¼é”™è¯¯');
}

const generatedImageBase64 = data.image.base64Data;
const generatedImageUri = `data:${data.image.mimeType};base64,${generatedImageBase64}`;

return generatedImageUri;
```

### é—®é¢˜åˆ†æ

API `https://toolkit.rork.com/images/edit/` çš„å®é™…å“åº”æ ¼å¼ä¸ºï¼š

```json
{
  "image": {
    "base64Data": "iVBORw0KGgoAAAANSUhEUgAA...",
    "mimeType": "image/jpeg"
  }
}
```

è€Œæ–°åŠŸèƒ½é”™è¯¯åœ°æœŸæœ›çš„å“åº”æ ¼å¼æ˜¯ï¼š
```json
{
  "images": [{ "url": "https://..." }]
}
```

è¿™å¯¼è‡´æ— æ³•æ­£ç¡®æå–ç”Ÿæˆçš„å›¾ç‰‡æ•°æ®ï¼Œä»è€Œæ˜¾ç¤º"ç”Ÿæˆå¤±è´¥"ã€‚

---

## âœ… ä¿®å¤å†…å®¹

### 1. **contrast-challenge.tsxï¼ˆåå·®èŒæŒ‘æˆ˜ï¼‰**

#### ä¿®å¤å‰
```typescript
const data = await response.json();
return data.images?.[0]?.url || data.output?.[0]?.url || data.image;
```

#### ä¿®å¤å
```typescript
const data = await response.json();

if (!data.image || !data.image.base64Data) {
  console.error('[ContrastChallenge] Invalid response data:', data);
  throw new Error('ç”Ÿæˆå¤±è´¥: æœåŠ¡å™¨è¿”å›æ•°æ®æ ¼å¼é”™è¯¯');
}

const generatedImageBase64 = data.image.base64Data;
const generatedImageUri = `data:${data.image.mimeType};base64,${generatedImageBase64}`;

return generatedImageUri;
```

### 2. **time-travel-album.tsxï¼ˆç©¿è¶Šç›¸å†Œï¼‰**

#### ä¿®å¤å‰
```typescript
const data = await response.json();
const resultUrl = data.images?.[0]?.url || data.output?.[0]?.url || data.image;
setResult(resultUrl);
```

#### ä¿®å¤å
```typescript
const data = await response.json();

if (!data.image || !data.image.base64Data) {
  console.error('[TimeTravelAlbum] Invalid response data:', data);
  throw new Error('ç”Ÿæˆå¤±è´¥: æœåŠ¡å™¨è¿”å›æ•°æ®æ ¼å¼é”™è¯¯');
}

const generatedImageBase64 = data.image.base64Data;
const generatedImageUri = `data:${data.image.mimeType};base64,${generatedImageBase64}`;

setResult(generatedImageUri);
```

### 3. **what-if-i-am.tsxï¼ˆå¦‚æœæˆ‘æ˜¯ï¼‰**

#### ä¿®å¤å‰
```typescript
const data = await response.json();
const resultUrl = data.images?.[0]?.url || data.output?.[0]?.url || data.image;
setResult(resultUrl);
```

#### ä¿®å¤å
```typescript
const data = await response.json();

if (!data.image || !data.image.base64Data) {
  console.error('[WhatIfIAm] Invalid response data:', data);
  throw new Error('ç”Ÿæˆå¤±è´¥: æœåŠ¡å™¨è¿”å›æ•°æ®æ ¼å¼é”™è¯¯');
}

const generatedImageBase64 = data.image.base64Data;
const generatedImageUri = `data:${data.image.mimeType};base64,${generatedImageBase64}`;

setResult(generatedImageUri);
```

---

## ğŸ”§ é¢å¤–æ”¹è¿›

### å¢å¼ºçš„é”™è¯¯å¤„ç†

ä¸ºæ¯ä¸ªåŠŸèƒ½æ·»åŠ äº†æ›´è¯¦ç»†çš„é”™è¯¯å¤„ç†ï¼š

```typescript
if (!response.ok) {
  const errorText = await response.text();
  console.error('[åŠŸèƒ½å] API Error:', response.status, errorText);
  
  if (response.status === 413) {
    throw new Error('å›¾ç‰‡æ•°æ®è¿‡å¤§ï¼Œè¯·é€‰æ‹©æ›´å°çš„ç…§ç‰‡');
  }
  
  if (response.status === 422) {
    throw new Error('è¯¥XXæš‚æ—¶æ— æ³•å¤„ç†ï¼Œè¯·æ›´æ¢ç…§ç‰‡æˆ–é€‰æ‹©å…¶ä»–XX');
  }
  
  throw new Error(`ç”Ÿæˆå¤±è´¥: HTTP ${response.status}`);
}
```

### é”™è¯¯ç±»å‹
- **413 Payload Too Large**ï¼šå›¾ç‰‡è¿‡å¤§
- **422 Unprocessable Entity**ï¼šé£æ ¼/åœºæ™¯/èŒä¸šæ— æ³•å¤„ç†
- **å…¶ä»–é”™è¯¯**ï¼šæ˜¾ç¤ºå…·ä½“çš„HTTPçŠ¶æ€ç 

---

## ğŸ“ ä¿®å¤å†å²å›é¡¾

### ç¬¬ä¸€æ¬¡å°è¯• âŒ
- **é—®é¢˜**ï¼šæ²¡æœ‰å›¾ç‰‡å‹ç¼©
- **ä¿®å¤**ï¼šæ·»åŠ äº† `expo-image-manipulator` å‹ç¼©
- **ç»“æœ**ï¼šä»ç„¶å¤±è´¥

### ç¬¬äºŒæ¬¡å°è¯• âŒ
- **é—®é¢˜**ï¼šAPIç«¯ç‚¹é”™è¯¯
- **ä¿®å¤**ï¼šä» `https://api.rfrm.app/v1/images/generations` æ”¹ä¸º `https://toolkit.rork.com/images/edit/`
- **ç»“æœ**ï¼šä»ç„¶å¤±è´¥

### ç¬¬ä¸‰æ¬¡å°è¯• âŒ
- **é—®é¢˜**ï¼šPromptæ ¼å¼ä¸å®Œæ•´
- **ä¿®å¤**ï¼šæ›´æ–° `COMMON_PROMPT_PREFIX` å’Œ `QUALITY_SUFFIX`
- **ç»“æœ**ï¼šä»ç„¶å¤±è´¥

### ç¬¬å››æ¬¡å°è¯• âœ…
- **é—®é¢˜**ï¼šAPIå“åº”è§£ææ–¹å¼é”™è¯¯
- **ä¿®å¤**ï¼šä½¿ç”¨æ­£ç¡®çš„Base64å“åº”è§£æ
- **ç»“æœ**ï¼šæˆåŠŸï¼ğŸ‰

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤

1. **åå·®èŒæŒ‘æˆ˜**
   - æ‰“å¼€é¦–é¡µ â†’ ç‚¹å‡»"åå·®èŒæŒ‘æˆ˜"
   - ä¸Šä¼ ç…§ç‰‡
   - é€‰æ‹©å¯¹æ¯”é£æ ¼ï¼ˆä¾‹å¦‚ï¼šä¼˜é›…æ·‘å¥³ vs è¡—å¤´é…·å¥³å­©ï¼‰
   - ç‚¹å‡»"ç”Ÿæˆå¯¹æ¯”å›¾"
   - âœ… åº”è¯¥æˆåŠŸç”Ÿæˆä¸¤å¼ å¯¹æ¯”é£æ ¼çš„å›¾ç‰‡

2. **ç©¿è¶Šç›¸å†Œ**
   - æ‰“å¼€é¦–é¡µ â†’ ç‚¹å‡»"ç©¿è¶Šç›¸å†Œ"
   - ä¸Šä¼ ç…§ç‰‡
   - é€‰æ‹©å†å²åœºæ™¯ï¼ˆä¾‹å¦‚ï¼šæ°‘å›½é£ã€80å¹´ä»£ï¼‰
   - ç‚¹å‡»"å¼€å§‹ç©¿è¶Š"
   - âœ… åº”è¯¥æˆåŠŸç”Ÿæˆç©¿è¶Šç…§ç‰‡

3. **å¦‚æœæˆ‘æ˜¯**
   - æ‰“å¼€é¦–é¡µ â†’ ç‚¹å‡»"å¦‚æœæˆ‘æ˜¯"
   - ä¸Šä¼ ç…§ç‰‡
   - é€‰æ‹©èŒä¸šï¼ˆä¾‹å¦‚ï¼šæ¼”å‘˜ã€å¾‹å¸ˆã€åŒ»ç”Ÿï¼‰
   - ç‚¹å‡»"å¼€å§‹ç”Ÿæˆ"
   - âœ… åº”è¯¥æˆåŠŸç”ŸæˆèŒä¸šç…§ç‰‡

---

## ğŸ“Š æŠ€æœ¯ç»†èŠ‚

### API ç«¯ç‚¹
```
POST https://toolkit.rork.com/images/edit/
```

### è¯·æ±‚æ ¼å¼
```json
{
  "prompt": "IMPORTANT: Keep face... Change the outfit to: [å…·ä½“é£æ ¼æè¿°] ...",
  "images": [
    {
      "type": "image",
      "image": "base64ç¼–ç çš„å›¾ç‰‡æ•°æ®"
    }
  ],
  "aspectRatio": "3:4"
}
```

### å“åº”æ ¼å¼
```json
{
  "image": {
    "base64Data": "iVBORw0KGgoAAAANSUhEUgAA...",
    "mimeType": "image/jpeg"
  }
}
```

### å›¾ç‰‡å¤„ç†æµç¨‹
1. ç”¨æˆ·é€‰æ‹©ç…§ç‰‡
2. ä½¿ç”¨ `expo-image-manipulator` å‹ç¼©ï¼ˆå®½åº¦800pxï¼Œè´¨é‡70%ï¼‰
3. è½¬æ¢ä¸ºBase64ç¼–ç 
4. æ„å»ºAPIè¯·æ±‚ï¼ˆåŒ…å«promptå’Œå›¾ç‰‡ï¼‰
5. å‘é€åˆ°API
6. æ¥æ”¶Base64å“åº”
7. è½¬æ¢ä¸ºData URI (`data:image/jpeg;base64,...`)
8. æ˜¾ç¤ºç»“æœå›¾ç‰‡

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å›¾ç‰‡å¤§å°é™åˆ¶
- å‹ç¼©åå®½åº¦ï¼š800px
- å‹ç¼©è´¨é‡ï¼š70%
- å¦‚æœä»ç„¶è§¦å‘413é”™è¯¯ï¼Œå»ºè®®ç”¨æˆ·é€‰æ‹©æ›´å°çš„ç…§ç‰‡

### æˆåŠŸç‡
- å¤§éƒ¨åˆ†ç…§ç‰‡åº”è¯¥å¯ä»¥æˆåŠŸç”Ÿæˆ
- éƒ¨åˆ†ç‰¹æ®Šç…§ç‰‡å¯èƒ½ä¼šè§¦å‘422é”™è¯¯ï¼ˆä¾‹å¦‚ï¼šäººè„¸ä¸æ¸…æ™°ã€å¤šäººç…§ç‰‡ç­‰ï¼‰

### æ¶ˆè€—é’»çŸ³
- æ¯æ¬¡ç”Ÿæˆæ¶ˆè€—10é’»çŸ³
- åå·®èŒæŒ‘æˆ˜ç”Ÿæˆä¸¤ä¸ªé£æ ¼ï¼Œæ¶ˆè€—20é’»çŸ³

---

## ğŸ‰ æ€»ç»“

âœ… **é—®é¢˜å·²å½»åº•è§£å†³ï¼**

å…³é”®ä¿®å¤ç‚¹ï¼š
1. âœ… ä½¿ç”¨æ­£ç¡®çš„APIå“åº”è§£ææ–¹å¼ï¼ˆBase64æ ¼å¼ï¼‰
2. âœ… æ·»åŠ è¯¦ç»†çš„é”™è¯¯å¤„ç†
3. âœ… ç»Ÿä¸€ä¸‰ä¸ªåŠŸèƒ½çš„å®ç°æ–¹å¼
4. âœ… ä¸ `outfit-change.tsx` ä¿æŒä¸€è‡´

ç°åœ¨ä¸‰ä¸ªåˆ›æ„åŠŸèƒ½åº”è¯¥éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼ğŸš€

---

## ğŸ“… ä¿®å¤æ—¥æœŸ

2026-01-22

## ğŸ‘¨â€ğŸ’» ç›¸å…³æ–‡ä»¶

- `rork--/app/contrast-challenge.tsx`
- `rork--/app/time-travel-album.tsx`
- `rork--/app/what-if-i-am.tsx`
- `rork--/app/outfit-change.tsx`ï¼ˆå‚è€ƒå®ç°ï¼‰
